<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMC Financial Calculators</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        .slider-thumb::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid white;
        }
        .tab-button.active {
            border-color: #3b82f6;
            color: #3b82f6;
            background-color: #e0f2fe;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 450px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div class="container mx-auto p-4 md:p-8">

        <header class="text-center mb-8">
            <img src="http://googleusercontent.com/file_content/1" alt="Aldrich Punnapuzha Jomon" class="mx-auto mb-2 w-48 md:w-64">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800">AMC FINANCIAL CALCULATOR</h1>
            <p class="text-slate-500 mt-2">Explore SWP, SIP, and PMS scenarios with interactive tools.</p>
        </header>

        <!-- Tab Navigation -->
        <nav class="mb-8 flex justify-center space-x-2 md:space-x-4 border-b border-slate-200 pb-4">
            <button id="tab-swp" class="tab-button px-4 py-2 rounded-md text-slate-600 hover:text-blue-600 hover:bg-slate-100 transition border border-transparent active">SWP Calculator</button>
            <button id="tab-sip" class="tab-button px-4 py-2 rounded-md text-slate-600 hover:text-blue-600 hover:bg-slate-100 transition border border-transparent">SIP Calculator</button>
            <button id="tab-pms" class="tab-button px-4 py-2 rounded-md text-slate-600 hover:text-blue-600 hover:bg-slate-100 transition border border-transparent">PMS Calculator</button>
        </nav>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- SWP Calculator Section -->
            <div id="calculator-swp" class="calculator-section lg:col-span-3 grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Column: Controls & Summary -->
                <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-md space-y-6">
                    <h2 class="text-xl font-semibold text-slate-700 border-b pb-2">SWP Investment Details</h2>
                    
                    <div>
                         <div class="flex justify-between items-center mb-1">
                            <label for="swp-rate-slider" class="block text-sm font-medium text-slate-600">Expected Return Rate (p.a.)</label>
                            <span id="swp-rate-value" class="font-semibold text-blue-600">8.0%</span>
                        </div>
                        <input id="swp-rate-slider" type="range" min="1" max="40" step="0.1" value="8" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <label for="swp-investment-slider" class="block text-sm font-medium text-slate-600">Total Investment</label>
                            <span id="swp-investment-value" class="font-semibold text-blue-600">₹500,000</span>
                        </div>
                        <input id="swp-investment-slider" type="range" min="10000" max="5000000" step="10000" value="500000" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                    </div>

                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <label for="swp-withdrawal-slider" class="block text-sm font-medium text-slate-600">Withdrawal per Month</label>
                            <span id="swp-withdrawal-value" class="font-semibold text-blue-600">₹10,000</span>
                        </div>
                        <input id="swp-withdrawal-slider" type="range" min="500" max="50000" step="500" value="10000" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <label for="swp-period-slider" class="block text-sm font-medium text-slate-600">Time Period (Years)</label>
                            <span id="swp-period-value" class="font-semibold text-blue-600">5 Years</span>
                        </div>
                        <input id="swp-period-slider" type="range" min="1" max="100" step="1" value="5" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                    </div>

                    <div class="pt-4 border-t mt-4">
                        <h3 class="text-lg font-semibold text-slate-700 mb-3">SWP Projected Results</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-500">Total Investment</span>
                                <span id="swp-total-investment" class="font-bold text-lg text-slate-800">₹5,00,000</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-500">Total Withdrawn</span>
                                <span id="swp-total-withdrawal" class="font-bold text-lg text-green-600">₹6,00,000</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-500">Final Value</span>
                                <span id="swp-final-value" class="font-bold text-lg text-blue-600">₹5,218</span>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md flex flex-col">
                    <h2 class="text-xl font-semibold text-slate-700 mb-4">SWP Investment Balance Over Time</h2>
                    <div class="chart-container flex-grow relative h-96">
                        <canvas id="swpChart"></canvas>
                    </div>
                    <div id="swp-chart-summary" class="text-center mt-4 text-slate-600 italic">
                        This chart illustrates how your investment balance changes over the selected period.
                    </div>
                </div>
            </div>

            <div id="calculator-sip" class="calculator-section hidden lg:col-span-3 grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-md space-y-6">
                    <h2 class="text-xl font-semibold text-slate-700 border-b pb-2">SIP Investment Details</h2>
                    
                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <label for="sip-rate-slider" class="block text-sm font-medium text-slate-600">Expected Return Rate (p.a.)</label>
                            <span id="sip-rate-display" class="font-semibold text-blue-600">8.60%</span>
                        </div>
                        <input id="sip-rate-slider" type="range" min="1" max="40" step="0.1" value="8.6" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                    </div>

                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <label for="sip-lumpsum-slider" class="block text-sm font-medium text-slate-600">Lumpsum Investment</label>
                            <span id="sip-lumpsum-value" class="font-semibold text-blue-600">₹0</span>
                        </div>
                        <input id="sip-lumpsum-slider" type="range" min="0" max="10000000" step="10000" value="0" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                    </div>
                
                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <label for="sip-monthly-slider" class="block text-sm font-medium text-slate-600">Monthly SIP Amount</label>
                            <span id="sip-monthly-value" class="font-semibold text-blue-600">₹25,000</span>
                        </div>
                        <input id="sip-monthly-slider" type="range" min="500" max="100000" step="500" value="25000" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <label for="sip-period-slider" class="block text-sm font-medium text-slate-600">Investment Duration (Years)</label>
                            <span id="sip-period-value" class="font-semibold text-blue-600">5 Years</span>
                        </div>
                        <input id="sip-period-slider" type="range" min="1" max="100" step="1" value="5" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                    </div>

                    <div class="pt-4 border-t mt-4">
                        <h3 class="text-lg font-semibold text-slate-700 mb-3">SIP Projected Results</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-500">Total Invested</span>
                                <span id="sip-total-invested" class="font-bold text-lg text-slate-800">₹0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-500">Expected Value at Maturity</span>
                                <span id="sip-expected-value" class="font-bold text-lg text-green-600">₹0</span>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md flex flex-col">
                    <h2 class="text-xl font-semibold text-slate-700 mb-4">SIP Projected Value Over Time</h2>
                    <div class="chart-container flex-grow relative h-96">
                        <canvas id="sipChart"></canvas>
                    </div>
                    <div id="sip-chart-summary" class="text-center mt-4 text-slate-600 italic">
                        This chart illustrates the projected growth of your SIP investment over the selected duration.
                    </div>
                </div>
            </div>

            <div id="calculator-pms" class="calculator-section hidden lg:col-span-3 grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-md space-y-6">
                    <h2 class="text-xl font-semibold text-slate-700 border-b pb-2">PMS Investment Details</h2>
                    
                    <div>
                        <label for="pms-select" class="block text-sm font-medium text-slate-600 mb-1">Select PMS Strategy</label>
                        <select id="pms-select" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        </select>
                    </div>

                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <label for="pms-investment-slider" class="block text-sm font-medium text-slate-600">Total Investment</label>
                            <span id="pms-investment-value" class="font-semibold text-blue-600">₹1,000,000</span>
                        </div>
                        <input id="pms-investment-slider" type="range" min="1000000" max="50000000" step="100000" value="1000000" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                    </div>

                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <label for="pms-period-slider" class="block text-sm font-medium text-slate-600">Investment Duration (Years)</label>
                            <span id="pms-period-value" class="font-semibold text-blue-600">5 Years</span>
                        </div>
                        <input id="pms-period-slider" type="range" min="1" max="10" step="1" value="5" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                    </div>

                    <div class="pt-4 border-t mt-4">
                        <h3 class="text-lg font-semibold text-slate-700 mb-3">Selected PMS Details</h3>
                        <div class="space-y-2 text-sm text-slate-600">
                            <p><strong>Strategy Type:</strong> <span id="pms-strategy-type">N/A</span></p>
                            <p><strong>Benchmark:</strong> <span id="pms-benchmark">N/A</span></p>
                            <p><strong>3Y CAGR:</strong> <span id="pms-cagr-3y">N/A</span></p>
                            <p><strong>5Y CAGR:</strong> <span id="pms-cagr-5y">N/A</span></p>
                            <p><strong>Since Inception Return:</strong> <span id="pms-cagr-inception">N/A</span></p>
                            <p><strong>Large Cap Allocation:</strong> <span id="pms-large-cap">N/A</span></p>
                            <p><strong>Mid Cap Allocation:</strong> <span id="pms-mid-cap">N/A</span></p>
                            <p><strong>Small Cap Allocation:</strong> <span id="pms-small-cap">N/A</span></p>
                            <p><strong>Top Sector:</strong> <span id="pms-top-sector">N/A</span></p>
                            <p><strong>Top Stock:</strong> <span id="pms-top-stock">N/A</span></p>
                        </div>
                    </div>

                    <div class="pt-4 border-t mt-4">
                        <h3 class="text-lg font-semibold text-slate-700 mb-3">PMS Projected Results</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-500">Projected Value (using 5Y CAGR)</span>
                                <span id="pms-projected-value" class="font-bold text-lg text-green-600">₹0</span>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md flex flex-col">
                    <h2 class="text-xl font-semibold text-slate-700 mb-4">PMS Projected Value Over Time</h2>
                    <div class="chart-container flex-grow relative h-96">
                        <canvas id="pmsChart"></canvas>
                    </div>
                    <div id="pms-chart-summary" class="text-center mt-4 text-slate-600 italic">
                        This chart illustrates the projected growth of your PMS investment over the selected duration.
                    </div>
                </div>
            </div>

        </main>
        
        <footer class="text-center mt-8 text-xs text-slate-400">
            <p>This calculator is for illustrative purposes only and does not constitute financial advice. Past performance is not indicative of future results.</p>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Data Definitions ---
            const pmsData = [
                {
                    name: 'Aditya Birla AMC: Core Equity',
                    strategyType: 'Core Equity Portfolio',
                    benchmark: 'Nifty 500 TRI',
                    cagr3Y: 0.145,
                    cagr5Y: 0.178,
                    sinceInceptionReturn: 0.201,
                    largeCap: 0.65,
                    midCap: 0.25,
                    smallCap: 0.1,
                    topSector: 'Financials (35%)',
                    topStock: 'HDFC Bank (8%)'
                },
                {
                    name: 'Aditya Birla AMC: India Special Opp.',
                    strategyType: 'India Special Opp. Portfolio',
                    benchmark: 'Nifty 500 TRI',
                    cagr3Y: 0.132,
                    cagr5Y: 0.154,
                    sinceInceptionReturn: 0.186,
                    largeCap: 0.45,
                    midCap: 0.35,
                    smallCap: 0.2,
                    topSector: 'Pharma (28%)',
                    topStock: 'Reliance Industries (7%)'
                },
                {
                    name: 'Aditya Birla AMC: Select Sector',
                    strategyType: 'Select Sector Portfolio',
                    benchmark: 'Nifty 500 TRI',
                    cagr3Y: 0.128,
                    cagr5Y: 0.149,
                    sinceInceptionReturn: 0.173,
                    largeCap: 0.3,
                    midCap: 0.4,
                    smallCap: 0.3,
                    topSector: 'IT (24%)',
                    topStock: 'TCS (6%)'
                },
                {
                    name: 'Aditya Birla AMC: Emerging Leaders',
                    strategyType: 'Emerging Leaders Portfolio',
                    benchmark: 'Nifty Midcap 100 TRI',
                    cagr3Y: 0.159,
                    cagr5Y: 0.172,
                    sinceInceptionReturn: 0.209,
                    largeCap: 0.3,
                    midCap: 0.5,
                    smallCap: 0.2,
                    topSector: 'Capital Goods (30%)',
                    topStock: 'L&T (9%)'
                },
                {
                    name: 'Aditya Birla AMC: Top 200 Core',
                    strategyType: 'Top 200 Core Portfolio',
                    benchmark: 'Nifty 200 TRI',
                    cagr3Y: 0.116,
                    cagr5Y: 0.138,
                    sinceInceptionReturn: 0.165,
                    largeCap: 0.88,
                    midCap: 0.08,
                    smallCap: 0.04,
                    topSector: 'Financials (27.7%)',
                    topStock: 'ICICI Bank (7.5%)'
                },
                {
                    name: 'Aditya Birla AMC: Dividend Yield',
                    strategyType: 'Dividend Yield Strategy',
                    benchmark: 'Nifty 500 TRI',
                    cagr3Y: 0.112,
                    cagr5Y: 0.125,
                    sinceInceptionReturn: 0.151,
                    largeCap: 0.75,
                    midCap: 0.15,
                    smallCap: 0.1,
                    topSector: 'Utilities (22%)',
                    topStock: 'NTPC (6.5%)'
                }
            ];

            // --- DOM Elements ---
            // Tabs
            const tabSwpBtn = document.getElementById('tab-swp');
            const tabSipBtn = document.getElementById('tab-sip');
            const tabPmsBtn = document.getElementById('tab-pms');
            const calculatorSwp = document.getElementById('calculator-swp');
            const calculatorSip = document.getElementById('calculator-sip');
            const calculatorPms = document.getElementById('calculator-pms');

            // SWP Elements
            const swpInvestmentSlider = document.getElementById('swp-investment-slider');
            const swpWithdrawalSlider = document.getElementById('swp-withdrawal-slider');
            const swpRateSlider = document.getElementById('swp-rate-slider');
            const swpPeriodSlider = document.getElementById('swp-period-slider');
            const swpInvestmentValue = document.getElementById('swp-investment-value');
            const swpWithdrawalValue = document.getElementById('swp-withdrawal-value');
            const swpRateValue = document.getElementById('swp-rate-value');
            const swpPeriodValue = document.getElementById('swp-period-value');
            const swpTotalInvestmentEl = document.getElementById('swp-total-investment');
            const swpTotalWithdrawalEl = document.getElementById('swp-total-withdrawal');
            const swpFinalValueEl = document.getElementById('swp-final-value');
            const swpChartSummaryEl = document.getElementById('swp-chart-summary');
            let swpChart;

            // SIP Elements
            const sipLumpsumSlider = document.getElementById('sip-lumpsum-slider');
            const sipMonthlySlider = document.getElementById('sip-monthly-slider');
            const sipPeriodSlider = document.getElementById('sip-period-slider');
            const sipLumpsumValue = document.getElementById('sip-lumpsum-value');
            const sipMonthlyValue = document.getElementById('sip-monthly-value');
            const sipPeriodValue = document.getElementById('sip-period-value');
            const sipRateSlider = document.getElementById('sip-rate-slider');
            const sipRateDisplay = document.getElementById('sip-rate-display');
            const sipTotalInvestedEl = document.getElementById('sip-total-invested');
            const sipExpectedValueEl = document.getElementById('sip-expected-value');
            const sipChartSummaryEl = document.getElementById('sip-chart-summary');
            let sipChart;

            // PMS Elements
            const pmsInvestmentSlider = document.getElementById('pms-investment-slider');
            const pmsPeriodSlider = document.getElementById('pms-period-slider');
            const pmsInvestmentValue = document.getElementById('pms-investment-value');
            const pmsPeriodValue = document.getElementById('pms-period-value');
            const pmsSelect = document.getElementById('pms-select');
            const pmsStrategyTypeEl = document.getElementById('pms-strategy-type');
            const pmsBenchmarkEl = document.getElementById('pms-benchmark');
            const pmsCagr3YEl = document.getElementById('pms-cagr-3y');
            const pmsCagr5YEl = document.getElementById('pms-cagr-5y');
            const pmsCagrInceptionEl = document.getElementById('pms-cagr-inception');
            const pmsLargeCapEl = document.getElementById('pms-large-cap');
            const pmsMidCapEl = document.getElementById('pms-mid-cap');
            const pmsSmallCapEl = document.getElementById('pms-small-cap');
            const pmsTopSectorEl = document.getElementById('pms-top-sector');
            const pmsTopStockEl = document.getElementById('pms-top-stock');
            const pmsProjectedValueEl = document.getElementById('pms-projected-value');
            const pmsChartContainer = document.querySelector('#calculator-pms .chart-container');
            const pmsChartSummaryEl = document.getElementById('pms-chart-summary');
            let pmsChart;


            // --- Utility Functions ---
            const formatCurrency = (num) => `₹${new Intl.NumberFormat('en-IN').format(Math.round(num))}`;
            const formatPercentage = (num) => `${(num * 100).toFixed(2)}%`;

            // --- Tab Switching Logic ---
            function showTab(tabId) {
                document.querySelectorAll('.calculator-section').forEach(section => {
                    section.classList.add('hidden');
                });
                document.getElementById(`calculator-${tabId}`).classList.remove('hidden');

                document.querySelectorAll('.tab-button').forEach(button => {
                    button.classList.remove('active');
                });
                document.getElementById(`tab-${tabId}`).classList.add('active');

                if (tabId === 'swp' && swpChart) swpChart.resize();
                if (tabId === 'sip' && sipChart) sipChart.resize();
                if (tabId === 'pms' && pmsChart) pmsChart.resize();
            }

            // --- SWP Calculator Functions ---
            function updateSwpDisplayValues() {
                swpInvestmentValue.textContent = formatCurrency(swpInvestmentSlider.value);
                swpWithdrawalValue.textContent = formatCurrency(swpWithdrawalSlider.value);
                swpRateValue.textContent = `${parseFloat(swpRateSlider.value).toFixed(2)}%`;
                swpPeriodValue.textContent = `${swpPeriodSlider.value} Year${swpPeriodSlider.value > 1 ? 's' : ''}`;
            }

            function calculateAndDisplaySwpResults() {
                const P = parseFloat(swpInvestmentSlider.value);
                const W = parseFloat(swpWithdrawalSlider.value);
                const r = parseFloat(swpRateSlider.value) / 100;
                const t = parseInt(swpPeriodSlider.value);

                const monthlyRate = r / 12;
                const totalMonths = t * 12;

                let balance = P;
                const balanceHistory = [P];
                
                for (let i = 0; i < totalMonths; i++) {
                    balance = balance * (1 + monthlyRate) - W;
                    if (balance < 0) balance = 0;
                    if ((i + 1) % 12 === 0 || i === totalMonths - 1) {
                         balanceHistory.push(balance);
                    }
                }
                
                const labels = Array.from({ length: t + 1 }, (_, i) => `Year ${i}`);

                updateSwpChart(labels, balanceHistory);

                swpTotalInvestmentEl.textContent = formatCurrency(P);
                swpTotalWithdrawalEl.textContent = formatCurrency(W * totalMonths);
                swpFinalValueEl.textContent = formatCurrency(balance);
                
                if (balance <= 0) {
                    const monthOfDepletion = balanceHistory.findIndex(b => b <= 0)
                    const yearOfDepletion = Math.ceil(monthOfDepletion / 12);
                    swpChartSummaryEl.textContent = `Your funds are projected to be depleted within ${yearOfDepletion} years based on these settings.`;
                } else {
                    swpChartSummaryEl.textContent = `After ${t} years, your investment is projected to have a final value of ${formatCurrency(balance)}.`;
                }
            }
            
            function updateSwpChart(labels, data) {
                if (swpChart) {
                    swpChart.data.labels = labels;
                    swpChart.data.datasets[0].data = data;
                    swpChart.update();
                } else {
                    const ctx = document.getElementById('swpChart').getContext('2d');
                    swpChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Investment Value',
                                data: data,
                                borderColor: 'rgba(59, 130, 246, 1)',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '₹' + new Intl.NumberFormat('en-IN', { notation: 'compact', compactDisplay: 'short' }).format(value);
                                        }
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.dataset.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.parsed.y !== null) {
                                                label += formatCurrency(context.parsed.y);
                                            }
                                            return label;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }

            function handleSwpInputChange() {
                updateSwpDisplayValues();
                calculateAndDisplaySwpResults();
            }

            // --- SIP Calculator Functions ---
            function updateSipDisplayValues() {
                sipLumpsumValue.textContent = formatCurrency(sipLumpsumSlider.value);
                sipMonthlyValue.textContent = formatCurrency(sipMonthlySlider.value);
                sipPeriodValue.textContent = `${sipPeriodSlider.value} Year${sipPeriodSlider.value > 1 ? 's' : ''}`;
                sipRateDisplay.textContent = `${parseFloat(sipRateSlider.value).toFixed(2)}%`;
            }

            function calculateAndDisplaySipResults() {
                const lumpsum = parseFloat(sipLumpsumSlider.value);
                const monthlySIP = parseFloat(sipMonthlySlider.value);
                const annualRate = parseFloat(sipRateSlider.value) / 100;
                const durationYears = parseInt(sipPeriodSlider.value);

                const monthlyRate = annualRate / 12;
                const totalMonths = durationYears * 12;

                let totalInvested = lumpsum + (monthlySIP * totalMonths);
                
                let futureValueLumpsum = lumpsum * Math.pow((1 + monthlyRate), totalMonths);
                
                let futureValueSIP = monthlySIP * ((Math.pow((1 + monthlyRate), totalMonths) - 1) / monthlyRate) * (1 + monthlyRate);

                let expectedValue = futureValueLumpsum + futureValueSIP;

                const balanceHistory = [];
                let currentLumpsumBalance = lumpsum;
                let currentSIPBalance = 0;

                for (let i = 0; i <= durationYears; i++) {
                    if (i === 0) {
                        balanceHistory.push(lumpsum);
                    } else {
                        currentLumpsumBalance = lumpsum * Math.pow((1 + annualRate), i);
                        let sipFV = monthlySIP * ((Math.pow((1 + monthlyRate), i * 12) - 1) / monthlyRate) * (1 + monthlyRate);
                        balanceHistory.push(currentLumpsumBalance + sipFV);
                    }
                }

                const labels = Array.from({ length: durationYears + 1 }, (_, i) => `Year ${i}`);
                updateSipChart(labels, balanceHistory);

                sipTotalInvestedEl.textContent = formatCurrency(totalInvested);
                sipExpectedValueEl.textContent = formatCurrency(expectedValue);

                sipChartSummaryEl.textContent = `After ${durationYears} years, your SIP investment is projected to grow to ${formatCurrency(expectedValue)}.`;
            }

            function updateSipChart(labels, data) {
                if (sipChart) {
                    sipChart.data.labels = labels;
                    sipChart.data.datasets[0].data = data;
                    sipChart.update();
                } else {
                    const ctx = document.getElementById('sipChart').getContext('2d');
                    sipChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Projected Value',
                                data: data,
                                borderColor: 'rgba(16, 185, 129, 1)',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '₹' + new Intl.NumberFormat('en-IN', { notation: 'compact', compactDisplay: 'short' }).format(value);
                                        }
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.dataset.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.parsed.y !== null) {
                                                label += formatCurrency(context.parsed.y);
                                            }
                                            return label;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }

            function handleSipInputChange() {
                updateSipDisplayValues();
                calculateAndDisplaySipResults();
            }

            // --- PMS Calculator Functions ---
            function populatePmsDropdown() {
                pmsData.forEach(pms => {
                    const option = document.createElement('option');
                    option.value = pms.name;
                    option.textContent = pms.name;
                    pmsSelect.appendChild(option);
                });
                pmsSelect.value = pmsData[0].name;
            }

            function updatePmsDisplayValues() {
                pmsInvestmentValue.textContent = formatCurrency(pmsInvestmentSlider.value);
                pmsPeriodValue.textContent = `${pmsPeriodSlider.value} Year${pmsPeriodSlider.value > 1 ? 's' : ''}`;
            }

            function calculateAndDisplayPmsResults() {
                const selectedPmsName = pmsSelect.value;
                const selectedPms = pmsData.find(p => p.name === selectedPmsName);

                if (selectedPms) {
                    pmsStrategyTypeEl.textContent = selectedPms.strategyType;
                    pmsBenchmarkEl.textContent = selectedPms.benchmark;
                    pmsCagr3YEl.textContent = formatPercentage(selectedPms.cagr3Y);
                    pmsCagr5YEl.textContent = formatPercentage(selectedPms.cagr5Y);
                    pmsCagrInceptionEl.textContent = formatPercentage(selectedPms.sinceInceptionReturn);
                    pmsLargeCapEl.textContent = formatPercentage(selectedPms.largeCap);
                    pmsMidCapEl.textContent = formatPercentage(selectedPms.midCap);
                    pmsSmallCapEl.textContent = formatPercentage(selectedPms.smallCap);
                    pmsTopSectorEl.textContent = selectedPms.topSector;
                    pmsTopStockEl.textContent = selectedPms.topStock;

                    const investment = parseFloat(pmsInvestmentSlider.value);
                    const duration = parseInt(pmsPeriodSlider.value);
                    const annualRate = selectedPms.cagr5Y;

                    const projectedValue = investment * Math.pow((1 + annualRate), duration);
                    pmsProjectedValueEl.textContent = formatCurrency(projectedValue);

                    const pmsChartLabels = Array.from({ length: duration + 1 }, (_, i) => `Year ${i}`);
                    const pmsChartData = [];
                    for (let i = 0; i <= duration; i++) {
                        pmsChartData.push(investment * Math.pow((1 + annualRate), i));
                    }
                    updatePmsChart(pmsChartLabels, pmsChartData);
                    pmsChartSummaryEl.textContent = `This chart illustrates the projected growth of your PMS investment over the selected duration, based on its 5-year CAGR.`;

                } else {
                    pmsStrategyTypeEl.textContent = 'N/A';
                    pmsBenchmarkEl.textContent = 'N/A';
                    pmsCagr3YEl.textContent = 'N/A';
                    pmsCagr5YEl.textContent = 'N/A';
                    pmsCagrInceptionEl.textContent = 'N/A';
                    pmsLargeCapEl.textContent = 'N/A';
                    pmsMidCapEl.textContent = 'N/A';
                    pmsSmallCapEl.textContent = 'N/A';
                    pmsTopSectorEl.textContent = 'N/A';
                    pmsTopStockEl.textContent = 'N/A';
                    pmsProjectedValueEl.textContent = formatCurrency(0);

                    updatePmsChart([], []);
                    pmsChartSummaryEl.textContent = `This chart illustrates the projected growth of your PMS investment over the selected duration.`;
                }
            }

            function updatePmsChart(labels, data) {
                if (pmsChart) {
                    pmsChart.data.labels = labels;
                    pmsChart.data.datasets[0].data = data;
                    pmsChart.update();
                } else {
                    const ctx = document.getElementById('pmsChart').getContext('2d');
                    pmsChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Projected Value',
                                data: data,
                                borderColor: 'rgba(234, 88, 12, 1)',
                                backgroundColor: 'rgba(234, 88, 12, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '₹' + new Intl.NumberFormat('en-IN', { notation: 'compact', compactDisplay: 'short' }).format(value);
                                        }
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.dataset.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.parsed.y !== null) {
                                                label += formatCurrency(context.parsed.y);
                                            }
                                            return label;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }

            function handlePmsInputChange() {
                updatePmsDisplayValues();
                calculateAndDisplayPmsResults();
            }

            // --- Event Listeners ---
            // Tab Buttons
            tabSwpBtn.addEventListener('click', () => showTab('swp'));
            tabSipBtn.addEventListener('click', () => showTab('sip'));
            tabPmsBtn.addEventListener('click', () => showTab('pms'));

            // SWP Listeners
            [swpInvestmentSlider, swpWithdrawalSlider, swpRateSlider, swpPeriodSlider].forEach(slider => {
                slider.addEventListener('input', handleSwpInputChange);
            });

            // SIP Listeners
            [sipLumpsumSlider, sipMonthlySlider, sipRateSlider, sipPeriodSlider].forEach(slider => {
                slider.addEventListener('input', handleSipInputChange);
            });

            // PMS Listeners
            pmsSelect.addEventListener('change', handlePmsInputChange);
            [pmsInvestmentSlider, pmsPeriodSlider].forEach(slider => {
                slider.addEventListener('input', handlePmsInputChange);
            });

            // --- Initial Setup ---
            populatePmsDropdown();

            handleSwpInputChange();
            handleSipInputChange();
            handlePmsInputChange();

            showTab('swp');
        });
    </script>
</body>
</html>
